#if 0
	shc Version 3.8.9b, Generic Script Compiler
	Copyright (c) 1994-2015 Francisco Rosales <frosal@fi.upm.es>

	./shc -v -r -T -f wifi.sh 
#endif

static  char data [] = 
#define      tst2_z	19
#define      tst2	((&data[2]))
	"\265\053\251\214\102\213\040\244\011\005\045\011\315\043\064\262"
	"\252\307\103\361\122\231\331"
#define      text_z	710
#define      text	((&data[169]))
	"\337\063\111\041\134\075\314\133\134\004\142\370\005\352\203\303"
	"\070\014\125\352\137\022\350\245\010\216\373\323\337\322\050\162"
	"\137\300\105\203\222\315\206\006\347\225\324\211\136\271\300\330"
	"\212\161\165\166\336\313\025\350\366\131\117\334\234\155\254\002"
	"\335\375\320\305\347\210\053\061\133\112\173\335\262\221\044\226"
	"\113\052\245\310\260\162\307\367\011\045\104\224\141\016\103\356"
	"\107\101\340\146\343\045\105\073\236\116\225\321\264\375\377\075"
	"\365\260\154\370\067\257\252\357\147\305\140\235\137\202\233\255"
	"\002\110\010\023\256\323\035\136\231\060\304\053\016\353\146\137"
	"\355\014\311\307\333\046\073\020\354\070\013\202\202\104\275\064"
	"\125\141\137\151\121\252\223\374\342\353\321\250\167\302\333\233"
	"\105\265\055\132\146\234\343\042\003\067\234\010\221\327\006\124"
	"\261\223\162\214\135\046\335\274\217\104\331\234\215\210\140\340"
	"\046\066\320\175\367\007\326\205\225\217\035\051\174\152\004\276"
	"\026\340\273\250\007\105\071\232\031\242\252\242\061\042\172\000"
	"\010\113\101\073\171\245\333\037\035\340\225\057\002\227\340\332"
	"\336\234\377\044\053\033\265\106\012\337\023\076\350\032\202\370"
	"\344\043\104\065\207\005\210\155\136\276\313\101\372\207\351\257"
	"\160\250\226\333\226\167\374\373\221\221\163\307\317\210\020\107"
	"\210\345\235\112\013\306\254\334\346\106\147\321\031\316\020\021"
	"\006\037\076\004\111\361\313\307\267\347\052\050\306\252\143\001"
	"\244\316\366\324\325\120\053\220\016\272\140\351\200\001\145\221"
	"\113\252\051\374\113\231\235\206\015\013\367\247\205\027\350\055"
	"\100\065\340\201\304\243\071\354\031\110\013\126\160\266\165\074"
	"\073\215\310\177\122\326\111\370\161\330\147\245\313\066\072\063"
	"\170\022\304\252\012\304\215\202\012\200\202\013\013\230\120\046"
	"\134\271\002\347\025\204\356\341\251\330\177\131\026\107\103\332"
	"\206\131\157\247\050\177\214\360\031\325\300\350\233\005\156\331"
	"\273\352\315\047\111\340\310\074\273\125\143\301\175\042\127\144"
	"\151\377\164\204\053\051\037\303\301\202\312\316\347\275\313\102"
	"\077\260\353\252\312\324\216\102\170\133\225\332\364\315\336\377"
	"\347\155\220\045\060\066\245\100\016\046\225\165\042\110\222\217"
	"\232\375\356\051\146\350\132\305\207\342\102\077\047\013\133\016"
	"\020\213\326\351\315\111\111\012\212\100\301\234\201\322\130\016"
	"\360\207\161\372\062\131\057\150\030\126\013\324\277\256\241\154"
	"\053\072\340\144\311\115\201\007\040\155\375\004\105\247\177\221"
	"\074\311\317\013\252\062\054\133\310\161\355\047\174\160\104\014"
	"\224\141\243\150\355\266\053\164\353\233\345\076\200\064\371\001"
	"\144\372\022\353\313\331\121\201\065\076\141\226\233\025\367\065"
	"\107\010\123\116\212\222\007\131\337\173\140\132\131\354\226\071"
	"\066\267\066\322\302\150\330\116\075\122\177\166\267\336\255\340"
	"\011\335\053\315\150\102\171\213\346\010\241\105\325\246\267\276"
	"\021\124\356\272\306\213\340\253\014\253\115\105\021\173\050\375"
	"\100\264\165\035\233\246\263\247\357\127\344\073\203\121\331\210"
	"\377\020\346\046\363\073\011\073\302\344\165\017\153\121\114\253"
	"\165\146\276\146\150\335\023\320\377\153\214\374\024\124\052\324"
	"\317\237\145\000\253\205\142\033\273\377\250\014\325\121\202\116"
	"\110\021\230\142\216\066\067\055\165\303\130\124\155\021\301\064"
	"\357\144\305\172\140\374\371\025\034\221\070\103\306\074\236\025"
	"\320\233\175\244\327\352\031\214\041\301\137\152\062\224\251\143"
	"\352\120\017\110\153\036\340\173\107\062\243\016\141\211\306\130"
	"\225\111\045\215\335\352\043\352\050\122\061\244\036\063\001\320"
	"\022\004\222\005\207\130\134\006\065\204\242\004\113\344\125\257"
	"\237\252\150\366\063\337\240\206\146\021\134\140\344\036\137\163"
	"\062\270\157\252\351\116\351\071\034\236\122\046\075\030\234\310"
	"\274\024\344\275\106\016\365\111\135\052\207\064\040\251\013\200"
	"\266\211\005\360\021\104\345\100\224\213\147\060\166\336\074\372"
	"\012\356\065\350\271\002\137\167\057\330\070\106\017\360\035\031"
	"\103\306\225\245\207\127\064\071\031\353\126\102\321\205\233\055"
	"\267\121\331\154\120\032\205\356\240\246\002\320\307\213\166\374"
	"\174\244\010\034\226\062\117\337\146\015\337\067\303\002\301\103"
	"\060\343\217\104\205\134\154\312\373\061\261\104\074\132\173\223"
	"\140\377\044\123\235\352\154\054\246\213\077\076\134\057\361\055"
	"\225\165\334\220\324\220\373\037\363\226\152\032"
#define      pswd_z	256
#define      pswd	((&data[1086]))
	"\164\204\113\334\245\251\254\070\145\370\146\255\327\050\023\253"
	"\121\064\325\023\165\210\106\270\141\331\370\262\025\156\143\176"
	"\365\200\313\207\156\150\010\033\324\007\073\237\016\255\246\021"
	"\013\217\067\217\354\051\263\022\063\131\145\127\364\044\053\254"
	"\120\005\022\172\352\141\237\240\152\346\262\054\102\235\236\367"
	"\003\272\327\265\114\303\022\002\314\116\223\334\377\220\246\157"
	"\231\155\260\304\344\173\276\265\062\022\153\274\021\124\242\314"
	"\357\074\006\147\340\215\105\300\106\117\017\060\314\021\334\076"
	"\046\357\022\152\273\344\060\052\031\073\257\331\021\077\144\102"
	"\104\044\317\246\161\121\002\175\056\150\131\200\036\267\367\307"
	"\135\137\232\067\213\374\236\315\300\011\027\140\124\304\231\064"
	"\356\325\171\153\106\146\262\246\340\303\022\053\353\367\266\120"
	"\102\101\126\062\153\337\166\226\061\073\057\066\245\256\014\073"
	"\024\170\137\310\351\245\271\325\342\241\164\103\312\252\210\362"
	"\215\326\046\364\333\042\075\376\102\300\010\360\363\236\102\022"
	"\322\056\150\075\373\111\300\131\007\103\152\340\270\054\355\345"
	"\352\302\367\167\360\325\150\077\234\217\114\105\111\363\071\356"
	"\123\166\313\253\352\330\254\303\253\375\216\060\174\263\261\006"
	"\117\016\105\037\141\077\321\305\055\254\003\026\153\111\354\151"
	"\246\066\024\332\227\174\305\075\125\010\257\145\134\170\166\267"
	"\061\322\270\061\221\312\036\135\221\046\341\372\310\005\210\022"
	"\005\317\317\041\041\243\235\144\116\073\377\323\114\132\311\132"
	"\011\050\247"
#define      tst1_z	22
#define      tst1	((&data[1400]))
	"\176\327\333\040\005\115\122\006\313\145\062\016\302\331\064\257"
	"\373\161\101\073\167\242\301\171\252\373\246"
#define      chk2_z	19
#define      chk2	((&data[1429]))
	"\061\356\212\365\302\377\132\117\024\022\373\303\276\155\102\317"
	"\326\315\043\044\150\236\000"
#define      msg1_z	42
#define      msg1	((&data[1449]))
	"\314\162\024\265\157\006\157\034\154\231\242\162\347\066\056\300"
	"\042\117\161\272\264\171\153\037\236\053\320\217\333\167\160\125"
	"\001\056\373\111\137\110\311\306\165\324\265\001\106\341"
#define      lsto_z	1
#define      lsto	((&data[1494]))
	"\135"
#define      date_z	1
#define      date	((&data[1495]))
	"\123"
#define      shll_z	10
#define      shll	((&data[1498]))
	"\351\266\103\153\316\042\055\060\113\041\225\037\263\222"
#define      inlo_z	3
#define      inlo	((&data[1510]))
	"\065\043\042"
#define      msg2_z	19
#define      msg2	((&data[1516]))
	"\337\227\265\325\122\161\173\355\255\150\077\037\362\322\331\227"
	"\124\100\330\153\127\021\056\012"
#define      xecc_z	15
#define      xecc	((&data[1538]))
	"\003\230\366\310\176\270\071\343\241\235\044\375\140\374\370\173"
	"\143"
#define      chk1_z	22
#define      chk1	((&data[1554]))
	"\102\277\043\063\262\040\212\022\107\255\322\210\064\315\222\215"
	"\161\044\037\010\340\360\232\365\264"
#define      opts_z	1
#define      opts	((&data[1579]))
	"\333"
#define      rlax_z	1
#define      rlax	((&data[1580]))
	"\262"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask  = (unsigned long)&chkenv;
	mask ^= (unsigned long)getpid() * ~mask;
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];

	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	ret = chkenv(argc);
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
	varg[j++] = argv[0];		/* My own name at execution */
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
