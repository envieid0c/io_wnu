#if 0
	shc Version 3.8.9b, Generic Script Compiler
	Copyright (c) 1994-2015 Francisco Rosales <frosal@fi.upm.es>

	./shc -v -r -T -f io_wnu_uninstall.sh 
#endif

static  char data [] = 
#define      msg2_z	19
#define      msg2	((&data[2]))
	"\206\120\217\327\225\200\017\357\320\266\313\112\217\011\317\272"
	"\221\201\213\305\260\365\002\353\213"
#define      opts_z	1
#define      opts	((&data[25]))
	"\376"
#define      date_z	1
#define      date	((&data[26]))
	"\021"
#define      tst1_z	22
#define      tst1	((&data[27]))
	"\214\024\372\126\035\167\041\371\310\211\040\372\150\065\176\212"
	"\343\225\003\342\045\000\051"
#define      rlax_z	1
#define      rlax	((&data[50]))
	"\277"
#define      text_z	1100
#define      text	((&data[305]))
	"\137\151\263\057\150\346\024\241\022\107\337\042\334\144\076\046"
	"\354\146\110\137\263\046\335\207\333\121\105\023\377\241\217\163"
	"\151\264\262\026\013\257\065\204\212\263\050\173\167\274\011\361"
	"\163\157\027\057\121\266\077\104\050\116\112\310\225\244\377\021"
	"\367\101\024\071\251\250\153\366\052\273\037\007\102\057\325\311"
	"\263\300\135\030\061\360\232\372\166\003\260\074\334\373\201\313"
	"\206\300\173\270\344\141\052\105\113\207\103\146\304\045\263\323"
	"\263\216\255\133\236\001\255\054\126\326\166\231\224\127\217\104"
	"\120\350\050\226\223\302\003\154\077\101\063\127\043\104\212\127"
	"\101\041\052\004\355\234\313\222\351\242\120\334\161\124\360\023"
	"\310\252\132\270\077\007\104\062\221\337\254\023\336\341\113\332"
	"\344\042\235\361\373\155\323\037\002\124\106\071\310\170\144\251"
	"\045\221\076\201\041\361\006\177\157\221\273\355\071\212\161\102"
	"\260\260\074\157\136\277\334\136\073\023\135\152\320\217\370\237"
	"\010\344\344\323\323\336\230\073\250\010\266\324\353\161\075\170"
	"\320\217\271\246\305\025\057\003\035\102\356\006\251\131\221\307"
	"\072\270\251\117\046\154\005\041\133\310\250\250\202\164\335\136"
	"\156\301\303\351\155\132\373\213\042\216\330\170\310\044\364\124"
	"\373\005\011\305\261\053\001\057\152\252\157\132\335\207\131\175"
	"\371\222\271\172\010\034\024\052\115\341\223\154\253\327\034\275"
	"\343\017\162\161\301\035\005\045\146\177\272\120\304\240\017\366"
	"\205\057\004\274\242\100\002\347\362\311\264\140\100\115\150\234"
	"\053\226\052\137\325\325\075\030\316\363\207\035\007\203\302\363"
	"\204\105\130\121\375\275\321\032\142\210\370\100\043\052\031\126"
	"\160\175\301\007\062\334\232\107\141\366\256\035\140\324\132\077"
	"\241\145\136\261\315\231\176\234\371\241\024\051\237\012\221\231"
	"\314\167\331\127\112\053\317\275\106\243\001\341\337\301\156\122"
	"\370\324\050\060\031\256\170\172\023\375\324\141\106\355\166\232"
	"\260\016\346\277\002\234\275\376\366\343\176\261\064\306\366\004"
	"\021\343\020\347\223\207\364\321\171\261\004\232\071\262\024\144"
	"\074\141\373\030\052\313\375\333\330\021\020\177\065\263\312\266"
	"\313\257\364\003\043\075\310\256\364\043\264\017\170\006\255\105"
	"\372\375\204\011\024\377\307\300\061\302\313\130\030\145\304\177"
	"\212\235\374\376\300\172\050\317\230\072\004\242\050\135\215\004"
	"\334\112\033\025\270\375\146\036\216\161\346\047\011\377\017\107"
	"\362\341\201\124\022\070\372\216\347\331\246\223\057\136\172\254"
	"\117\211\066\166\210\035\020\102\170\371\132\230\013\276\246\333"
	"\227\006\047\237\321\305\134\301\144\340\244\106\106\223\076\235"
	"\145\003\013\132\155\212\265\362\034\302\257\227\165\215\201\117"
	"\112\373\076\375\075\140\354\107\206\330\372\242\014\355\362\375"
	"\115\342\351\057\330\262\130\351\034\254\211\173\261\131\301\270"
	"\333\312\376\323\261\136\376\325\206\067\023\007\043\171\173\366"
	"\235\272\123\147\030\273\343\114\235\334\255\336\250\302\006\217"
	"\107\003\041\357\310\012\112\364\365\007\303\046\327\135\052\351"
	"\303\212\167\362\042\116\244\375\303\072\010\034\174\117\251\066"
	"\035\210\042\115\147\071\203\353\374\076\205\245\236\160\100\130"
	"\237\060\105\104\233\126\371\250\160\140\052\222\062\033\360\255"
	"\310\243\101\122\315\372\334\025\224\255\172\272\133\153\003\306"
	"\124\101\165\137\055\163\132\362\355\301\337\366\364\102\344\357"
	"\163\041\215\370\222\324\222\260\110\324\336\143\352\115\154\304"
	"\232\244\052\314\163\034\031\225\274\042\316\370\232\163\247\073"
	"\313\357\064\040\050\231\377\171\060\334\252\040\236\206\223\245"
	"\354\111\076\370\252\057\355\344\020\233\374\320\311\207\013\225"
	"\326\342\163\342\267\054\357\267\325\031\376\306\120\106\015\126"
	"\017\335\376\314\314\370\271\077\025\340\271\012\240\044\371\036"
	"\252\067\134\154\212\357\372\211\112\242\236\231\341\255\235\272"
	"\141\372\374\141\305\143\116\213\037\140\350\023\223\122\310\224"
	"\071\225\112\216\332\142\135\224\160\027\022\337\373\253\365\012"
	"\212\141\030\226\267\357\277\204\100\201\336\241\203\001\005\336"
	"\015\107\226\221\370\065\074\212\143\011\112\233\273\063\312\334"
	"\350\376\173\275\240\110\052\046\057\235\153\350\145\216\063\045"
	"\371\340\101\136\207\067\276\245\071\254\205\367\317\303\054\136"
	"\206\371\016\121\205\323\063\261\233\236\272\121\076\310\137\051"
	"\332\145\030\214\106\114\016\332\322\106\317\314\367\353\126\364"
	"\350\311\230\241\346\004\367\162\265\226\277\176\330\327\365\327"
	"\243\346\144\165\042\335\137\211\305\054\143\220\265\013\061\032"
	"\072\264\156\324\371\305\133\300\232\066\241\166\132\236\320\107"
	"\130\253\063\361\272\315\246\231\360\006\060\270\172\127\275\330"
	"\060\031\241\333\130\366\305\347\122\022\305\164\356\063\143\003"
	"\363\016\102\011\250\026\026\127\320\204\037\347\345\173\203\145"
	"\267\225\347\246\177\356\214\271\300\007\051\105\015\322\157\100"
	"\014\321\014\371\066\013\316\233\271\130\241\157\037\057\157\104"
	"\313\007\225\162\004\212\032\215\133\153\076\160\377\215\335\212"
	"\260\365\067\355\077\200\254\140\055\217\302\241\171\045\256\166"
	"\173\265\115\023\316\076\103\134\206\106\053\010\253\044\004\037"
	"\250\070\115\304\345\001\217\307\363\234\117\214\261\130\226\024"
	"\331\012\261\125\216\065\252\035\320\237\321\013\144\250\053\201"
	"\051\221\070\106\065\261\076\174\175\102\232\112\263\371\260\163"
	"\352\210\167\372\171\244\161\144\150\267\205\021\112\070\367\054"
	"\133\321\234\262\051\124\252\017\221\012\263\065\022\303\003\306"
	"\322\130\036\321\363\262\024\314\257\260\245\002\275\307\003\205"
	"\215\156\020\363\022\006\074\342\211\070\250\255\162\315\214\337"
	"\260\103\312\111\051\003\135\201\203\241\127\352\234\073\063\164"
	"\123\116\070\054\215\261\122\102\270\227\236\247\002\272\174\017"
	"\156\211\337\370\134\243\353\105\176\335\231\365\336\123\333\041"
	"\276\047\326\164\275\032\220\202\341\004\217\271\101\234\255\300"
	"\266\143\361\335\252\242\234\021\174\264\321\057\020\275\034\017"
	"\264\101\304\125\144\231\174\151\124\177\076\002\156\031\057\221"
	"\266\010\261\164\247\034\170\360\354\361\375\377\174\240\023\213"
	"\241\030\155\260\307\261\121\112\115\205\041\152\073\070\231\277"
	"\371\343\127\136\003\254\135\267\067\342\276\332\203\062\307\132"
	"\154\314\262\264\170"
#define      pswd_z	256
#define      pswd	((&data[1542]))
	"\326\361\113\224\247\136\045\100\176\023\224\202\255\057\135\263"
	"\374\111\360\350\333\157\243\140\342\251\001\234\271\271\237\004"
	"\267\365\005\344\221\306\101\027\177\145\046\072\147\137\160\151"
	"\163\175\331\144\347\342\150\001\270\070\124\030\112\326\345\147"
	"\154\122\306\116\336\142\204\273\113\144\330\374\314\314\333\066"
	"\023\014\110\113\010\316\367\076\204\020\113\043\305\061\171\245"
	"\073\223\043\165\366\221\313\142\212\155\354\100\073\301\103\312"
	"\040\172\066\371\312\172\076\057\110\347\044\325\314\215\115\202"
	"\051\347\250\210\303\262\257\315\111\215\372\062\052\015\151\103"
	"\013\223\276\073\135\065\076\043\361\307\140\057\072\237\025\240"
	"\267\233\051\110\351\050\326\127\266\157\345\246\054\125\330\121"
	"\065\352\275\030\110\355\146\044\266\063\001\361\210\135\106\241"
	"\337\343\110\266\205\255\010\315\177\077\074\240\114\377\374\344"
	"\175\306\161\326\343\132\324\205\354\057\311\337\025\157\167\300"
	"\273\267\217\252\124\174\006\374\057\066\347\122\263\205\337\313"
	"\045\215\104\264\016\102\345\123\161\177\344\025\133\030\332\102"
	"\361\314\226\273\256\266\060\121\201\110\204\363\265\274\143\302"
	"\327\003\202\311\305\105\077\377\160\031\170\062\175\104\160\240"
	"\327\053\025\312\272\151\372\143\321"
#define      msg1_z	42
#define      msg1	((&data[1817]))
	"\334\200\011\127\112\117\321\243\254\050\156\342\246\017\364\351"
	"\234\273\237\366\070\262\002\144\257\260\337\037\152\076\017\245"
	"\166\363\222\302\043\322\102\023\200\022\023\327\065\017\333\107"
	"\376\166\313\133\355\077\235\241\126\347\051\106"
#define      tst2_z	19
#define      tst2	((&data[1870]))
	"\055\100\210\176\102\225\202\064\065\343\323\150\243\363\077\103"
	"\216\306\345\046"
#define      shll_z	10
#define      shll	((&data[1891]))
	"\124\043\155\263\057\025\303\132\134\365\343\047\324"
#define      chk2_z	19
#define      chk2	((&data[1902]))
	"\312\007\173\115\015\013\034\003\166\050\262\146\030\233\315\162"
	"\276\221\140\357\374\337\112"
#define      lsto_z	1
#define      lsto	((&data[1925]))
	"\264"
#define      inlo_z	3
#define      inlo	((&data[1926]))
	"\110\277\070"
#define      chk1_z	22
#define      chk1	((&data[1934]))
	"\117\023\367\037\342\022\315\007\057\125\175\365\310\063\327\147"
	"\235\153\071\135\034\310\210\164\033\105\333\144\065\334\204"
#define      xecc_z	15
#define      xecc	((&data[1961]))
	"\202\221\241\370\035\143\055\163\163\136\311\374\174\120\056\301"
	"\051\062\333"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask  = (unsigned long)&chkenv;
	mask ^= (unsigned long)getpid() * ~mask;
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];

	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	ret = chkenv(argc);
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
	varg[j++] = argv[0];		/* My own name at execution */
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
