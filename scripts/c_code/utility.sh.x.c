#if 0
	shc Version 3.8.9b, Generic Script Compiler
	Copyright (c) 1994-2015 Francisco Rosales <frosal@fi.upm.es>

	./shc -v -r -T -f utility.sh 
#endif

static  char data [] = 
#define      xecc_z	15
#define      xecc	((&data[1]))
	"\232\044\215\271\340\147\115\003\213\007\222\040\375\007\166\313"
	"\271\330\123"
#define      rlax_z	1
#define      rlax	((&data[19]))
	"\002"
#define      opts_z	1
#define      opts	((&data[20]))
	"\040"
#define      lsto_z	1
#define      lsto	((&data[21]))
	"\042"
#define      inlo_z	3
#define      inlo	((&data[22]))
	"\262\202\177"
#define      text_z	897
#define      text	((&data[157]))
	"\145\124\172\015\376\165\225\310\371\173\363\345\245\316\150\305"
	"\050\136\376\044\153\220\146\323\163\142\314\070\153\207\171\260"
	"\353\104\204\137\061\127\377\041\003\120\277\033\212\015\135\341"
	"\145\246\050\317\234\132\063\303\364\326\005\037\204\210\307\002"
	"\010\107\104\136\260\147\034\061\106\335\074\244\034\063\175\070"
	"\016\047\321\147\304\042\115\015\231\001\133\372\301\361\227\301"
	"\215\265\313\210\363\147\265\253\245\101\061\103\273\210\167\343"
	"\123\031\161\172\066\072\026\346\105\040\030\310\124\216\165\137"
	"\147\264\007\247\005\225\322\016\212\323\161\265\357\304\211\321"
	"\215\312\150\277\122\123\320\212\051\360\334\356\347\153\061\124"
	"\254\207\074\000\026\345\332\265\372\235\201\040\040\232\274\312"
	"\031\274\200\350\276\047\077\173\116\355\327\316\161\022\216\165"
	"\340\273\220\035\101\104\353\201\030\125\144\035\301\030\353\263"
	"\342\332\243\112\027\115\144\020\245\055\351\031\315\117\070\007"
	"\027\126\242\320\176\332\115\126\352\267\021\106\364\077\000\002"
	"\200\101\206\336\122\343\030\347\075\370\171\010\140\040\344\233"
	"\351\203\136\100\235\014\056\053\103\261\347\126\161\056\377\173"
	"\272\151\031\277\255\015\005\271\073\341\212\065\047\331\326\357"
	"\222\304\024\002\343\374\236\301\132\251\316\074\271\255\073\115"
	"\102\363\270\352\123\132\361\021\214\116\241\230\107\026\103\220"
	"\131\172\375\121\142\352\121\263\310\015\312\257\141\224\253\334"
	"\367\334\006\017\167\257\062\135\235\271\025\373\212\342\007\110"
	"\075\267\047\134\302\363\232\260\170\341\206\100\161\065\216\210"
	"\003\151\174\305\137\337\263\076\364\353\232\041\020\136\014\007"
	"\006\277\246\246\352\350\106\277\000\343\200\354\116\267\205\367"
	"\127\005\031\304\020\261\166\135\376\121\306\035\265\261\262\340"
	"\014\303\022\126\245\144\227\051\037\176\143\010\024\036\222\301"
	"\071\302\334\222\234\155\016\216\113\245\330\364\072\031\170\227"
	"\034\214\224\225\065\010\341\377\302\012\076\046\261\257\316\354"
	"\165\364\103\050\252\035\345\024\064\312\311\260\117\012\261\251"
	"\053\256\165\257\232\274\246\147\303\144\343\224\047\245\225\004"
	"\352\102\257\065\136\373\275\365\155\250\315\135\121\352\326\116"
	"\071\351\260\115\312\003\055\172\374\260\225\064\046\275\054\352"
	"\315\132\324\113\036\047\061\256\163\160\300\373\006\322\254\001"
	"\073\356\250\014\124\070\053\061\044\306\117\027\055\321\272\024"
	"\371\047\002\243\213\040\375\360\257\265\017\273\345\365\153\332"
	"\153\236\104\003\151\115\213\351\014\126\375\130\115\244\121\357"
	"\254\377\304\164\221\344\321\016\127\344\263\110\207\231\153\066"
	"\334\137\072\214\345\206\024\013\377\244\077\346\147\262\251\221"
	"\305\332\076\005\346\270\054\065\043\312\375\052\237\051\115\066"
	"\016\306\351\122\231\267\016\210\331\164\125\357\157\100\153\141"
	"\167\051\326\366\207\327\273\277\150\073\207\115\214\213\373\272"
	"\317\144\251\202\306\317\043\203\366\025\122\245\351\330\206\070"
	"\221\323\032\270\272\132\243\312\352\073\266\113\341\210\257\306"
	"\330\140\256\322\072\027\276\332\070\367\105\065\015\144\011\010"
	"\061\304\326\004\030\101\024\071\142\305\275\377\172\002\332\214"
	"\336\055\310\120\311\206\345\341\335\323\061\262\137\343\350\073"
	"\025\031\122\127\027\314\347\373\370\376\246\141\205\356\357\124"
	"\352\377\207\051\173\202\210\370\044\015\352\007\000\372\356\072"
	"\134\372\220\241\007\335\032\373\104\162\205\212\244\342\201\037"
	"\033\362\267\301\136\045\054\114\320\120\227\063\176\375\222\167"
	"\061\027\364\031\333\241\211\231\307\115\251\114\040\273\345\037"
	"\366\334\252\317\365\172\116\007\155\222\127\243\355\105\115\116"
	"\322\243\205\111\024\216\162\311\316\110\307\025\210\050\143\075"
	"\023\357\203\056\200\372\213\336\075\303\326\376\132\166\206\176"
	"\262\006\015\146\043\101\356\356\174\064\227\323\117\156\356\077"
	"\163\260\265\045\360\340\374\154\120\146\207\155\065\063\331\163"
	"\333\151\057\127\314\150\214\150\156\060\335\357\362\336\244\274"
	"\240\237\257\007\172\173\067\222\142\060\316\223\073\306\340\331"
	"\145\056\345\062\225\040\020\015\217\002\151\221\125\070\324\132"
	"\335\341\344\371\361\110\355\272\124\347\245\122\044\346\266\263"
	"\136\266\032\217\170\353\157\216\000\305\111\276\260\334\320\214"
	"\216\101\365\017\124\004\137\316\262\026\022\152\264\232\342\234"
	"\224\272\334\336\226\141\113\106\054\146\062\243\210\271\327\243"
	"\017\160\277\033\075\027\137\154\140\076\351\306\143\125\330\002"
	"\342\373\273\264\221\364\002\377\110\353\044\040\311\007\017\060"
	"\354\146\162\231\100\064\373\075\251\276\000\251\101\144\024\007"
	"\042\145\201\126\231\053\174\205\171\310\132\042\303\260\157\220"
	"\332\376\017\151\230\050\011\003\326\340\314\363\215\171\061\011"
	"\114\007\137\275\314\123\155\264\062\334\201\353\312\351\150\347"
	"\353\177\005\306\057\334\273\337\172\015\237\242\056"
#define      tst2_z	19
#define      tst2	((&data[1160]))
	"\037\106\040\152\136\273\211\024\261\036\017\020\261\215\156\326"
	"\175\002\007\110\311"
#define      chk1_z	22
#define      chk1	((&data[1181]))
	"\057\131\025\014\303\215\166\105\151\276\147\311\202\265\072\213"
	"\253\134\335\363\016\334\030\165\242\077\361\130\212"
#define      tst1_z	22
#define      tst1	((&data[1210]))
	"\207\004\077\125\064\021\354\027\015\141\173\171\160\245\154\373"
	"\304\163\107\371\110\373\261\103"
#define      msg2_z	19
#define      msg2	((&data[1232]))
	"\354\140\057\313\317\255\161\211\011\164\175\343\026\222\227\223"
	"\010\126\054\351\047\127\103"
#define      chk2_z	19
#define      chk2	((&data[1255]))
	"\161\311\345\072\207\011\304\101\145\012\044\221\243\265\261\113"
	"\000\177\116\201"
#define      pswd_z	256
#define      pswd	((&data[1288]))
	"\160\301\250\145\266\315\233\276\116\340\222\102\122\166\250\346"
	"\216\230\320\336\305\034\051\113\226\244\244\111\243\277\245\026"
	"\126\164\163\034\131\120\011\361\216\317\000\166\200\255\120\122"
	"\230\336\334\200\323\167\127\115\313\322\234\012\215\263\363\131"
	"\222\265\274\340\325\050\020\003\250\216\045\055\215\043\221\213"
	"\330\035\036\347\103\026\013\313\354\343\371\175\330\172\200\221"
	"\213\206\356\177\252\311\256\036\325\263\256\201\377\375\071\024"
	"\074\057\076\346\172\226\235\015\216\217\003\174\271\220\015\157"
	"\263\037\166\236\330\103\356\106\276\064\007\062\242\113\337\061"
	"\126\373\226\032\172\120\172\337\057\353\324\064\220\116\145\061"
	"\207\316\217\173\101\077\004\337\350\237\104\242\375\360\114\041"
	"\303\151\254\076\303\074\042\007\047\162\320\365\142\274\341\272"
	"\012\213\343\043\346\335\306\317\065\040\303\317\210\135\274\206"
	"\064\060\341\143\077\377\356\016\020\251\340\042\340\022\031\345"
	"\354\025\267\123\373\023\034\103\323\356\215\270\332\152\012\333"
	"\252\212\357\114\113\206\107\257\302\243\222\163\260\010\030\327"
	"\062\311\045\004\124\322\037\007\200\353\254\134\214\062\117\104"
	"\054\262\373\006\210\172\113\266\023\236\310\015\344\025\317\303"
	"\175\206\116\221\251\156\014\252\002\167\130\305\272\254"
#define      msg1_z	42
#define      msg1	((&data[1585]))
	"\344\165\041\164\147\256\237\275\125\345\364\116\306\364\031\163"
	"\352\273\037\201\303\116\157\100\027\364\042\341\027\064\215\172"
	"\006\201\344\306\314\207\217\312\266\310\062\213\123\311\307\163"
	"\344\263\242\274\034\214\232\147\041\002\113\033"
#define      date_z	1
#define      date	((&data[1637]))
	"\135"
#define      shll_z	10
#define      shll	((&data[1639]))
	"\317\274\041\236\275\110\244\261\373\263\106\000\243"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask  = (unsigned long)&chkenv;
	mask ^= (unsigned long)getpid() * ~mask;
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];

	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	ret = chkenv(argc);
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
	varg[j++] = argv[0];		/* My own name at execution */
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
