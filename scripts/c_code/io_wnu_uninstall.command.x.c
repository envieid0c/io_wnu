#if 0
	shc Version 3.9.6, Generic Shell Script Compiler
	GNU GPL Version 3 Md Jahidul Hamid <jahidulhamid@yahoo.com>

	./shc -v -r -f io_wnu_uninstall.command 
#endif

static  char data [] = 
#define      msg2_z	19
#define      msg2	((&data[2]))
	"\257\126\272\162\344\373\300\020\127\352\373\331\003\034\001\314"
	"\245\026\017\214\113"
#define      tst2_z	19
#define      tst2	((&data[22]))
	"\000\035\303\364\174\124\220\213\030\176\220\002\313\125\272\376"
	"\345\372\163\217\245\130"
#define      xecc_z	15
#define      xecc	((&data[45]))
	"\337\045\202\367\075\362\203\005\332\135\243\133\225\265\373\035"
	"\174\370"
#define      msg1_z	65
#define      msg1	((&data[69]))
	"\031\015\214\302\355\017\306\277\351\055\041\044\235\256\171\340"
	"\265\035\176\046\357\000\152\373\055\044\301\201\136\017\211\220"
	"\341\305\211\355\222\045\335\256\031\241\373\370\312\127\313\235"
	"\230\121\030\356\246\012\134\256\151\001\060\115\371\002\107\132"
	"\167\226\264\154\036\326\136\126\123\254\313\133\005"
#define      date_z	1
#define      date	((&data[138]))
	"\331"
#define      text_z	1249
#define      text	((&data[407]))
	"\323\213\212\114\266\313\055\252\316\260\024\342\200\174\246\044"
	"\213\122\037\010\103\262\262\207\345\247\233\326\075\377\207\177"
	"\152\365\257\024\052\164\106\104\011\020\072\277\167\033\165\363"
	"\167\267\132\306\074\203\120\213\226\231\032\310\070\306\373\013"
	"\246\002\006\130\054\063\374\127\173\256\214\027\045\177\006\126"
	"\030\267\305\177\040\234\057\111\115\312\203\231\023\116\166\260"
	"\353\105\321\035\352\315\342\330\251\321\334\114\010\245\266\110"
	"\366\054\167\341\152\350\214\301\213\220\350\162\206\324\210\107"
	"\265\172\370\200\135\101\050\070\332\110\373\101\157\332\113\037"
	"\305\341\205\100\254\320\115\034\274\111\357\106\361\337\064\216"
	"\371\171\264\270\167\373\263\221\026\035\054\057\066\216\332\044"
	"\334\156\247\216\030\132\007\066\102\235\006\023\353\106\107\021"
	"\363\043\347\243\331\214\020\373\005\034\042\043\235\314\072\201"
	"\007\164\273\030\111\064\341\165\016\060\272\065\330\162\164\353"
	"\141\371\325\265\005\226\116\326\227\302\262\236\235\372\222\165"
	"\042\016\030\043\322\312\115\010\166\214\017\034\136\336\166\005"
	"\220\070\203\165\220\062\113\050\323\041\041\127\274\267\162\056"
	"\250\023\142\234\152\376\260\110\315\226\306\364\321\051\156\021"
	"\225\246\336\275\004\344\373\076\343\311\012\175\044\055\045\156"
	"\256\172\347\147\122\153\322\251\242\042\261\313\007\277\025\175"
	"\122\175\253\002\263\014\057\315\254\365\333\000\263\211\167\111"
	"\273\105\305\263\130\113\126\236\124\062\370\071\162\367\332\162"
	"\144\364\122\210\001\332\010\114\346\106\007\116\165\262\245\010"
	"\043\164\035\074\170\162\102\225\045\201\170\142\306\265\071\037"
	"\302\112\314\302\315\304\046\361\003\132\234\270\102\020\236\215"
	"\127\121\122\253\270\040\227\213\371\371\004\345\120\076\376\020"
	"\262\021\350\324\357\011\242\257\277\126\211\037\077\306\215\033"
	"\323\167\357\115\150\102\104\346\267\266\202\360\343\220\274\217"
	"\235\301\050\260\043\127\047\111\277\150\202\055\131\100\056\204"
	"\055\125\267\064\204\027\046\117\014\276\015\141\223\342\226\340"
	"\130\025\017\267\220\204\016\230\373\151\124\136\116\171\113\113"
	"\150\235\046\334\333\126\017\264\224\161\361\026\257\001\340\270"
	"\242\020\046\164\132\221\073\241\173\044\044\163\301\143\077\043"
	"\040\347\373\204\153\346\042\123\133\134\255\042\302\213\010\211"
	"\115\147\143\364\244\204\174\073\070\146\072\130\115\245\243\355"
	"\006\247\250\332\176\074\253\300\051\355\217\037\215\063\206\367"
	"\211\047\054\106\260\375\307\351\274\341\235\352\244\033\204\201"
	"\106\000\033\057\056\337\111\205\340\030\163\232\347\027\205\103"
	"\176\311\041\036\363\075\024\242\175\242\006\016\335\006\032\220"
	"\221\247\323\342\107\304\324\226\352\062\074\161\073\262\047\333"
	"\316\063\131\253\227\326\034\371\320\015\216\323\124\161\000\355"
	"\014\246\101\234\024\020\333\303\015\337\104\101\107\345\137\256"
	"\133\127\366\043\206\202\311\364\000\124\073\054\312\171\162\107"
	"\124\031\222\120\042\135\144\042\373\175\004\265\356\151\157\253"
	"\151\057\104\000\150\262\055\060\205\266\053\232\110\154\025\325"
	"\020\305\347\155\157\356\315\047\070\203\221\121\140\327\306\357"
	"\017\014\143\102\121\075\065\056\073\236\072\173\050\302\126\211"
	"\250\057\024\370\025\076\044\156\374\352\007\320\356\022\106\215"
	"\311\123\305\326\201\103\156\117\101\071\264\140\150\337\363\311"
	"\207\120\214\262\233\136\361\334\034\111\337\064\146\250\125\073"
	"\370\210\116\177\313\037\370\330\351\127\373\244\330\233\017\027"
	"\263\077\364\164\256\044\332\034\352\161\225\013\176\206\123\043"
	"\267\245\004\213\234\112\373\133\375\216\265\236\276\037\234\333"
	"\274\065\151\252\373\267\173\176\367\074\171\114\045\231\330\074"
	"\103\071\017\235\166\375\241\033\112\133\247\064\071\174\254\234"
	"\151\010\111\246\365\233\071\366\140\332\046\115\063\273\277\206"
	"\107\133\033\147\214\333\177\117\207\160\311\170\115\072\222\344"
	"\350\333\215\147\121\113\027\222\324\150\335\204\100\207\321\255"
	"\336\215\125\001\206\044\154\201\335\024\253\035\351\131\131\220"
	"\147\374\221\023\061\156\134\156\031\054\342\051\263\052\157\240"
	"\162\266\123\264\076\341\230\237\220\352\007\340\246\077\325\202"
	"\346\112\013\316\230\316\024\317\306\077\274\130\065\034\154\351"
	"\162\170\242\042\023\207\362\055\322\274\167\173\327\256\252\273"
	"\242\247\114\364\314\332\106\001\070\246\162\354\137\361\045\314"
	"\104\303\313\313\202\356\060\233\135\262\054\313\170\110\166\015"
	"\332\313\155\264\301\001\320\064\377\300\126\307\154\372\156\154"
	"\131\203\063\117\043\142\132\311\061\177\000\273\332\035\052\312"
	"\171\301\270\173\254\201\255\007\175\005\264\115\067\056\131\327"
	"\057\122\175\257\035\112\002\262\353\254\314\133\071\203\160\137"
	"\305\331\165\170\362\034\252\274\166\276\113\133\227\355\144\117"
	"\341\231\260\236\315\166\253\365\163\026\115\244\061\300\070\347"
	"\214\142\251\014\060\332\371\331\047\000\243\054\324\156\274\254"
	"\112\130\304\036\137\226\205\327\213\175\202\363\251\061\113\134"
	"\045\072\167\143\320\007\344\106\032\070\310\052\032\321\204\241"
	"\225\270\014\171\336\175\305\032\261\010\073\072\304\141\202\017"
	"\055\135\366\005\363\124\322\130\332\340\346\304\302\267\101\165"
	"\376\173\361\007\002\044\237\125\227\012\324\362\222\234\107\360"
	"\367\165\242\200\324\170\263\350\073\363\361\207\166\372\370\376"
	"\156\313\362\013\346\114\226\210\232\044\221\202\225\234\067\356"
	"\031\365\262\125\224\156\110\167\265\103\115\342\063\132\355\133"
	"\342\255\377\140\161\127\162\277\112\173\374\265\024\266\007\172"
	"\337\321\057\322\337\230\072\246\326\233\220\361\146\355\106\225"
	"\125\006\264\020\317\050\000\026\160\237\031\204\375\001\061\204"
	"\301\051\105\373\363\305\333\360\036\266\325\201\111\272\175\114"
	"\064\143\232\130\075\363\166\160\016\321\361\232\337\115\337\223"
	"\314\206\307\315\177\007\125\021\122\201\310\271\027\135\007\214"
	"\121\006\351\232\306\065\124\227\057\251\023\334\155\111\314\227"
	"\062\177\101\122\250\317\136\155\241\132\016\233\012\143\372\075"
	"\102\350\060\302\236\300\304\236\023\051\142\370\136\220\201\316"
	"\314\341\165\132\351\341\225\271\035\066\376\267\165\111\300\172"
	"\050\236\023\166\125\341\054\173\033\225\140\134\353\143\223\143"
	"\311\204\303\151\012\320\201\003\334\050\340\011\214\046\164\053"
	"\234\364\054\240\204\234\022\042\323\045\163\365\130\352\003\260"
	"\311\146\164\266\350\132\141\271\001\255\334\150\270\061\015\021"
	"\034\065\336\222\262\207\030\172\241\345\317\345\144\024\350\171"
	"\061\231\171\021\264\072\175\113\073\246\350\006\222\213\165\013"
	"\161\033\123\125\201\072\173\124\132\021\152\012\117\216\122\211"
	"\032\203\065\137\125\046\240\131\171\363\165\360\261\142\024\037"
	"\245\263\315\037\326\344\064\133\236\055\151\103\315\016\244\041"
	"\155\056\120\335\007\062\340\366\110\130\362\315\375\035\257\033"
	"\237\155\345\167\371\141\123\170\213\042\052\370\332\302\036\374"
	"\364\332\214\307\004\262\171\356\135\330\053\201\060\354\276\155"
	"\334\121\112\225\170\171\163"
#define      shll_z	10
#define      shll	((&data[1780]))
	"\113\111\107\044\101\105\217\340\227\365\324\026"
#define      rlax_z	1
#define      rlax	((&data[1790]))
	"\266"
#define      opts_z	1
#define      opts	((&data[1791]))
	"\305"
#define      chk2_z	19
#define      chk2	((&data[1796]))
	"\374\100\355\052\313\000\337\270\166\353\270\064\073\050\015\120"
	"\020\306\325\005\101\375\073\210\100\063\067"
#define      pswd_z	256
#define      pswd	((&data[1831]))
	"\135\337\060\217\041\200\111\252\122\221\136\076\215\114\313\251"
	"\175\012\146\256\015\366\126\013\243\235\116\347\040\014\350\053"
	"\317\277\031\215\353\364\320\023\170\153\200\202\357\356\054\301"
	"\270\132\073\042\337\247\030\064\374\151\014\373\360\011\264\216"
	"\034\170\251\041\166\205\132\354\215\112\227\215\051\314\263\105"
	"\150\135\151\365\341\306\267\227\364\153\174\117\224\062\141\254"
	"\112\053\016\354\300\136\031\366\141\335\127\017\116\171\227\244"
	"\134\077\116\044\245\171\127\003\027\337\241\064\066\233\363\211"
	"\357\050\163\045\277\231\131\352\002\374\300\022\337\150\373\241"
	"\273\361\366\105\224\215\246\236\023\220\012\242\272\016\015\145"
	"\344\307\145\237\305\270\004\255\305\332\320\273\313\361\135\316"
	"\363\300\202\140\064\310\153\351\121\142\331\031\316\221\054\172"
	"\166\027\047\306\325\347\030\106\270\151\361\354\050\174\133\044"
	"\360\234\144\340\224\205\105\321\255\030\166\172\123\222\102\346"
	"\001\222\050\064\062\305\260\127\243\343\065\136\070\163\104\215"
	"\353\176\136\371\241\373\262\017\050\171\361\037\072\055\362\146"
	"\120\366\361\346\370\141\273\023\011\205\141\164\164\242\252\371"
	"\052\060\273\035\124\137\015\344\132\111\204\242\154\261\257\267"
	"\172\151\316\136\115\216\156\040\156\276\006\043\341\067\160\312"
	"\214\217\051\260\254\351\270\040\145\116\272\350\161\035\040\055"
	"\113\212\371\046\132"
#define      inlo_z	3
#define      inlo	((&data[2144]))
	"\046\277\307"
#define      lsto_z	1
#define      lsto	((&data[2147]))
	"\203"
#define      tst1_z	22
#define      tst1	((&data[2153]))
	"\226\021\354\130\210\034\133\231\304\041\174\275\031\035\074\233"
	"\035\266\153\151\363\034\263\145\142\361\233\071\265"
#define      chk1_z	22
#define      chk1	((&data[2179]))
	"\176\227\131\275\251\015\307\144\152\225\003\302\346\361\122\100"
	"\342\255\015\337\337\116\074\174\257\125\033\337\176"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */
#define BUSYBOXON	0	/* Define as 1 to enable work with busybox */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

void chkenv_end(void);

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask = (unsigned long)getpid();
	stte_0();
	 key(&chkenv, (void*)&chkenv_end - (void*)&chkenv);
	 key(&data, sizeof(data));
	 key(&mask, sizeof(mask));
	arc4(&mask, sizeof(mask));
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

void chkenv_end(void){}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];
	if (me == NULL) { me = getenv("_"); }
	if (me == 0) { fprintf(stderr, "E: neither argv[0] nor $_ works."); exit(1); }

	ret = chkenv(argc);
	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
#if BUSYBOXON
	varg[j++] = "busybox";
	varg[j++] = "sh";
#else
	varg[j++] = argv[0];		/* My own name at execution */
#endif
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
