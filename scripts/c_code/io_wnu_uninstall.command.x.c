#if 0
	shc Version 3.9.6, Generic Shell Script Compiler
	GNU GPL Version 3 Md Jahidul Hamid <jahidulhamid@yahoo.com>

	./shc -v -r -f io_wnu_uninstall.command 
#endif

static  char data [] = 
#define      lsto_z	1
#define      lsto	((&data[0]))
	"\041"
#define      tst2_z	19
#define      tst2	((&data[1]))
	"\105\337\055\331\157\175\213\113\154\264\105\257\054\253\356\063"
	"\333\172\264"
#define      chk2_z	19
#define      chk2	((&data[22]))
	"\330\220\116\261\334\235\223\360\051\237\304\015\353\135\271\274"
	"\262\006\333\015\351\046\326"
#define      msg1_z	65
#define      msg1	((&data[55]))
	"\035\315\104\352\343\320\155\220\332\064\252\273\347\132\255\211"
	"\076\006\240\113\110\044\111\004\026\344\340\121\145\165\036\121"
	"\272\301\312\260\115\346\277\064\273\105\044\255\016\202\372\241"
	"\004\145\155\173\024\154\217\016\036\155\224\135\007\035\024\000"
	"\063\232\013\071\235\006\213\150\333\026\073\355\247\273\131"
#define      opts_z	1
#define      opts	((&data[122]))
	"\203"
#define      text_z	1249
#define      text	((&data[319]))
	"\136\325\042\151\125\157\334\334\124\103\342\010\022\060\112\016"
	"\020\302\165\221\361\362\316\256\324\251\346\341\360\147\312\127"
	"\336\060\052\120\071\376\145\257\175\274\141\027\027\045\342\035"
	"\270\340\276\165\151\050\135\346\056\100\176\276\227\347\076\014"
	"\143\113\335\110\143\256\310\123\072\360\373\007\002\065\304\226"
	"\067\177\257\337\320\211\004\357\072\307\364\250\376\060\227\336"
	"\336\013\106\254\027\376\000\366\073\037\011\065\115\122\144\137"
	"\312\075\301\246\345\001\217\035\305\273\112\363\173\257\174\360"
	"\077\251\105\225\303\152\052\324\217\113\324\006\246\115\216\146"
	"\134\046\063\164\012\023\015\145\125\061\306\263\020\073\217\250"
	"\303\372\304\071\102\217\002\064\024\363\016\177\346\043\126\326"
	"\332\270\116\336\370\372\057\251\305\077\252\053\351\255\234\233"
	"\117\356\330\355\024\130\026\167\102\202\204\347\234\125\150\156"
	"\301\343\007\026\060\200\163\032\231\244\124\247\340\164\051\115"
	"\143\315\011\024\220\243\352\235\361\014\002\213\222\221\160\251"
	"\076\027\131\241\215\222\262\352\027\214\321\102\354\127\365\347"
	"\271\323\253\033\206\373\356\072\377\107\163\035\360\142\055\077"
	"\122\064\034\264\250\301\367\003\057\104\123\377\037\271\344\041"
	"\321\014\131\175\300\157\201\032\031\134\203\226\031\316\047\157"
	"\134\113\275\075\134\212\326\166\323\262\275\060\232\362\141\205"
	"\042\123\176\161\134\347\166\156\330\335\360\243\304\024\045\216"
	"\320\011\350\062\333\271\252\034\141\007\267\277\266\303\056\205"
	"\160\356\322\263\051\350\067\024\076\225\046\041\263\366\170\111"
	"\246\351\374\367\067\077\347\264\251\234\375\126\274\275\004\163"
	"\331\341\352\333\370\207\156\041\317\162\052\236\052\363\007\206"
	"\172\162\335\175\147\303\065\345\264\342\015\143\343\334\102\355"
	"\257\353\137\217\135\327\115\344\341\262\305\160\006\054\066\071"
	"\050\335\140\005\216\377\160\020\021\103\014\157\236\314\244\074"
	"\300\012\120\251\000\377\332\226\055\053\265\377\345\301\153\143"
	"\045\352\132\011\171\267\227\016\227\036\134\123\227\250\105\222"
	"\016\355\053\151\162\312\374\105\312\245\324\222\133\024\310\277"
	"\255\037\125\142\126\131\011\103\367\226\353\005\040\242\172\173"
	"\204\214\174\126\377\120\376\041\143\120\120\333\147\004\270\354"
	"\302\007\032\233\234\150\133\174\065\342\013\010\223\363\366\147"
	"\212\052\061\222\360\255\241\247\127\004\057\160\077\254\333\101"
	"\026\235\225\004\107\371\375\220\374\207\022\313\030\316\321\305"
	"\137\111\276\173\110\164\241\205\056\163\171\336\124\322\223\225"
	"\250\337\325\361\132\324\075\160\074\015\337\251\335\221\066\006"
	"\215\031\115\234\140\145\205\203\326\157\001\321\351\225\265\263"
	"\345\032\355\267\345\347\123\333\150\153\173\057\034\246\101\366"
	"\111\176\171\007\031\326\200\004\372\316\254\273\367\020\120\116"
	"\237\035\242\324\102\201\327\365\217\016\157\246\160\250\060\253"
	"\305\373\114\310\246\044\361\022\330\237\042\060\314\323\210\213"
	"\276\177\107\023\260\335\377\072\201\334\060\024\307\206\151\327"
	"\035\340\350\251\376\103\073\326\047\233\271\245\326\031\300\360"
	"\026\352\233\153\165\226\362\225\366\253\233\301\350\274\130\203"
	"\313\234\117\163\233\036\121\375\066\321\261\055\210\325\076\231"
	"\011\105\255\000\046\167\317\253\073\370\302\125\145\143\224\261"
	"\261\274\265\001\012\136\222\257\055\202\071\314\334\106\065\113"
	"\054\055\225\177\044\007\361\315\321\341\225\223\253\250\224\065"
	"\276\244\304\171\060\264\175\205\160\367\374\111\065\302\354\313"
	"\233\032\227\210\333\304\024\356\221\072\224\317\377\113\322\353"
	"\044\001\202\013\023\277\077\012\032\251\032\251\201\153\216\112"
	"\242\305\003\174\227\032\335\077\163\263\043\073\200\127\137\144"
	"\245\370\032\113\274\134\173\215\335\177\321\210\264\140\266\325"
	"\002\206\016\165\205\023\237\165\134\207\323\322\302\074\321\212"
	"\155\162\351\350\155\112\350\141\056\225\067\014\267\206\023\257"
	"\034\121\210\315\353\040\066\121\167\046\027\027\154\134\105\124"
	"\160\232\144\233\206\114\002\175\003\114\205\164\072\065\341\317"
	"\250\151\071\141\265\025\302\100\027\310\251\116\235\131\240\062"
	"\102\261\254\320\135\232\327\351\256\346\071\007\171\243\165\223"
	"\027\172\127\137\257\334\175\214\372\007\042\044\235\233\014\111"
	"\112\030\200\142\021\353\371\141\211\104\221\150\145\271\053\054"
	"\073\210\103\034\146\212\021\371\163\013\232\076\122\017\106\145"
	"\070\077\251\144\234\021\026\143\243\353\072\347\247\120\202\154"
	"\154\241\340\177\000\142\024\231\104\035\320\221\361\077\352\221"
	"\312\066\217\262\245\346\015\102\265\054\117\341\030\217\063\123"
	"\104\222\032\022\361\041\246\305\017\037\233\142\166\253\077\325"
	"\230\356\136\110\304\034\026\211\114\377\136\243\036\063\037\360"
	"\307\024\366\305\006\002\031\076\114\116\110\204\073\065\203\213"
	"\171\301\064\344\302\007\200\331\135\012\050\007\132\353\213\132"
	"\153\063\254\146\147\364\362\374\357\152\353\060\032\327\242\161"
	"\314\001\346\026\377\375\212\124\072\340\002\032\223\017\100\206"
	"\161\077\220\154\146\341\272\272\245\252\243\352\010\171\022\151"
	"\126\067\303\370\243\126\022\040\326\326\022\366\017\164\130\050"
	"\314\262\176\256\075\167\131\245\305\364\105\171\264\013\230\254"
	"\111\342\272\352\132\136\206\376\031\123\375\214\154\126\161\100"
	"\164\153\117\145\006\374\254\377\000\041\136\352\216\163\052\012"
	"\200\000\126\254\360\224\246\053\363\033\305\053\004\366\312\221"
	"\253\246\166\000\144\266\206\353\044\171\273\023\206\372\316\123"
	"\173\231\052\111\323\215\063\242\013\015\307\305\221\227\315\137"
	"\217\345\375\057\164\210\333\152\327\003\215\264\173\061\045\146"
	"\377\175\141\362\244\105\307\040\167\166\211\336\237\277\212\177"
	"\306\255\067\302\227\010\235\117\075\117\172\367\155\320\166\367"
	"\152\143\331\077\362\210\225\206\172\075\045\063\153\120\240\250"
	"\021\324\365\265\123\243\131\043\116\014\240\164\216\065\257\127"
	"\130\073\256\156\261\141\252\341\204\060\361\171\352\252\261\252"
	"\236\066\272\277\030\014\047\071\016\324\001\067\124\217\303\162"
	"\355\166\363\171\143\345\321\363\274\241\223\130\204\022\032\313"
	"\301\301\072\115\262\062\045\025\163\111\017\043\207\207\277\025"
	"\271\365\267\005\367\051\012\076\371\221\361\163\377\274\077\127"
	"\042\264\176\063\173\212\047\021\355\147\364\155\101\110\103\162"
	"\004\072\062\136\270\344\212\311\076\247\220\115"
#define      xecc_z	15
#define      xecc	((&data[1607]))
	"\167\177\235\077\117\325\112\126\322\035\217\356\015\015\240\046"
	"\106\005"
#define      inlo_z	3
#define      inlo	((&data[1625]))
	"\335\173\377"
#define      tst1_z	22
#define      tst1	((&data[1628]))
	"\262\202\364\074\017\125\237\077\051\326\206\156\016\144\010\277"
	"\340\041\025\176\230\055\236\052\172"
#define      pswd_z	256
#define      pswd	((&data[1675]))
	"\200\062\216\046\032\123\317\010\315\326\304\267\270\236\227\367"
	"\042\257\172\242\317\124\101\365\033\311\220\226\110\170\134\052"
	"\072\343\026\322\230\331\200\116\034\303\116\015\165\222\045\321"
	"\131\242\043\104\171\042\130\110\137\163\031\127\131\264\264\046"
	"\302\003\006\133\247\123\345\253\325\364\012\245\371\064\015\235"
	"\225\023\013\130\315\343\030\063\325\317\040\101\123\334\350\277"
	"\330\002\025\003\127\043\120\361\330\133\077\023\243\363\205\262"
	"\134\041\304\337\330\371\332\272\130\162\062\317\317\334\050\047"
	"\372\244\213\214\161\154\253\143\050\062\007\242\240\261\247\214"
	"\245\030\220\365\126\075\121\011\063\073\300\323\350\325\166\220"
	"\153\276\376\152\315\067\074\141\035\322\107\247\224\340\124\355"
	"\167\377\200\276\157\337\255\231\324\225\115\242\315\035\336\014"
	"\351\145\111\354\157\233\011\316\327\045\302\265\004\320\304\355"
	"\145\346\154\241\234\260\365\173\072\376\001\150\257\074\073\037"
	"\331\101\356\072\042\076\263\230\277\142\001\247\306\375\353\217"
	"\363\324\277\071\231\352\236\132\112\011\245\026\333\307\072\256"
	"\252\206\067\164\320\251\366\005\133\075\312\211\067\211\153\354"
	"\063\205\255\036\303\226\325\033"
#define      date_z	1
#define      date	((&data[1933]))
	"\267"
#define      chk1_z	22
#define      chk1	((&data[1938]))
	"\312\224\041\013\206\345\361\072\172\130\253\157\161\346\100\015"
	"\206\261\116\355\064\242\125\304\001\361\316\137\236\266\004"
#define      msg2_z	19
#define      msg2	((&data[1969]))
	"\365\273\231\323\255\232\037\076\101\324\152\377\101\113\020\323"
	"\010\311\163\154\226\003\241\105\104"
#define      shll_z	10
#define      shll	((&data[1990]))
	"\306\323\065\152\024\122\064\055\017\361"
#define      rlax_z	1
#define      rlax	((&data[2000]))
	"\054"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */
#define BUSYBOXON	0	/* Define as 1 to enable work with busybox */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

void chkenv_end(void);

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask = (unsigned long)getpid();
	stte_0();
	 key(&chkenv, (void*)&chkenv_end - (void*)&chkenv);
	 key(&data, sizeof(data));
	 key(&mask, sizeof(mask));
	arc4(&mask, sizeof(mask));
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

void chkenv_end(void){}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];
	if (me == NULL) { me = getenv("_"); }
	if (me == 0) { fprintf(stderr, "E: neither argv[0] nor $_ works."); exit(1); }

	ret = chkenv(argc);
	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
#if BUSYBOXON
	varg[j++] = "busybox";
	varg[j++] = "sh";
#else
	varg[j++] = argv[0];		/* My own name at execution */
#endif
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
