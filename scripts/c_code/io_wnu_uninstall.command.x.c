#if 0
	shc Version 3.9.6, Generic Shell Script Compiler
	GNU GPL Version 3 Md Jahidul Hamid <jahidulhamid@yahoo.com>

	./shc -v -r -f io_wnu_uninstall.command 
#endif

static  char data [] = 
#define      msg1_z	65
#define      msg1	((&data[6]))
	"\226\164\377\211\224\105\216\231\266\361\127\043\050\211\316\146"
	"\161\305\125\064\276\072\130\074\037\314\013\003\064\331\065\247"
	"\365\157\103\145\251\005\010\221\327\352\157\123\317\016\212\014"
	"\206\105\210\013\241\326\042\164\302\376\263\044\107\040\026\056"
	"\304\243\161\224\211\071\222\345\057\274\006\031\214\342\105\307"
	"\070\335"
#define      tst2_z	19
#define      tst2	((&data[86]))
	"\077\173\312\346\057\026\024\240\215\146\125\375\007\020\036\114"
	"\217\253\277\273\025\222\232\372\325\341\157"
#define      date_z	1
#define      date	((&data[109]))
	"\002"
#define      shll_z	10
#define      shll	((&data[112]))
	"\042\041\341\142\163\072\074\220\077\375\251\251\127"
#define      tst1_z	22
#define      tst1	((&data[124]))
	"\376\363\260\357\115\114\045\001\112\200\102\017\060\345\171\363"
	"\262\254\212\230\036\027\070\320\057\231\346"
#define      text_z	1249
#define      text	((&data[413]))
	"\111\333\367\016\220\302\157\356\140\173\050\015\215\226\216\056"
	"\373\172\370\127\370\010\347\123\233\113\055\310\114\131\204\061"
	"\331\000\361\327\250\353\032\234\230\077\237\354\005\204\211\005"
	"\113\312\012\006\124\326\325\135\045\024\300\021\135\372\166\102"
	"\301\127\226\262\062\214\334\053\005\162\114\174\341\106\210\235"
	"\353\270\317\227\064\110\356\216\031\072\124\223\140\357\146\240"
	"\323\216\003\336\377\362\000\221\225\245\103\321\035\060\341\046"
	"\170\160\355\021\243\162\275\324\102\002\173\164\307\155\232\276"
	"\315\141\371\372\373\127\045\172\105\357\176\014\014\345\112\135"
	"\073\301\013\134\001\340\241\321\105\244\127\377\167\137\116\322"
	"\371\253\014\150\302\063\104\273\224\160\027\133\232\277\037\207"
	"\373\267\363\003\161\016\216\234\314\352\173\270\136\202\244\062"
	"\026\042\005\153\121\323\105\325\124\235\221\007\237\045\024\105"
	"\361\352\027\236\231\250\117\146\206\072\056\101\203\247\045\177"
	"\115\117\147\253\177\021\271\003\357\067\055\121\220\000\053\273"
	"\147\224\240\146\072\322\030\112\232\205\226\127\032\231\060\127"
	"\144\244\110\303\061\161\126\124\320\044\143\205\102\207\224\164"
	"\172\102\132\046\147\356\263\233\161\006\223\335\315\367\323\053"
	"\236\307\271\303\227\070\023\170\273\321\172\362\266\311\026\010"
	"\005\325\337\010\365\237\161\210\111\372\020\155\125\343\351\074"
	"\252\063\123\272\253\011\364\350\361\323\222\315\204\211\334\157"
	"\052\133\106\361\265\035\362\125\044\253\312\354\112\030\251\105"
	"\114\106\324\317\321\231\171\053\034\011\240\041\175\154\305\151"
	"\134\261\061\337\142\041\233\075\155\013\000\326\170\211\036\177"
	"\172\361\064\304\322\263\360\160\255\166\003\255\064\253\316\063"
	"\343\106\061\115\217\277\111\340\151\251\234\026\230\056\365\304"
	"\304\050\266\036\200\014\265\330\316\343\202\327\237\272\221\217"
	"\331\021\103\141\370\036\030\007\371\367\062\031\007\232\033\321"
	"\122\004\174\156\344\026\356\323\064\110\107\217\014\112\062\303"
	"\121\360\302\300\062\331\171\262\204\321\023\032\260\302\353\354"
	"\221\332\150\327\334\002\244\115\361\373\054\267\155\306\370\075"
	"\333\223\240\335\246\312\157\327\173\362\276\115\375\124\107\143"
	"\013\040\061\373\045\106\277\070\276\356\362\257\335\105\032\342"
	"\013\011\322\246\012\024\126\174\371\244\340\272\113\227\226\170"
	"\240\250\111\235\142\262\275\025\147\051\062\203\120\301\010\153"
	"\263\236\127\022\023\156\045\204\031\364\102\277\222\363\155\302"
	"\262\152\110\370\047\027\265\373\215\251\301\237\135\000\235\217"
	"\065\255\307\352\305\063\226\006\001\260\251\271\165\150\070\204"
	"\114\215\024\323\046\064\212\116\353\224\365\262\260\064\265\202"
	"\075\006\246\352\137\225\313\215\152\305\317\130\161\356\107\243"
	"\221\175\126\241\064\052\333\064\323\227\302\273\135\066\242\251"
	"\115\172\153\250\254\307\045\021\117\100\301\253\366\135\107\277"
	"\233\337\116\115\224\273\100\375\156\317\113\314\113\277\345\227"
	"\152\364\031\352\305\010\163\020\364\162\107\003\021\334\042\010"
	"\330\073\066\206\345\320\115\225\002\311\126\016\266\316\233\200"
	"\272\075\152\054\205\041\312\303\215\250\357\326\237\246\136\026"
	"\037\057\212\031\030\142\331\177\226\116\124\073\326\344\367\105"
	"\357\011\017\140\360\076\076\200\316\165\265\277\136\211\110\254"
	"\266\027\224\014\205\320\363\012\244\315\002\023\155\300\267\053"
	"\313\301\073\245\104\365\300\064\020\161\213\204\067\257\277\161"
	"\310\040\051\150\167\024\117\162\375\364\330\040\316\330\072\212"
	"\203\105\235\112\166\235\261\257\356\052\034\212\253\071\015\252"
	"\077\150\325\127\011\211\140\045\361\364\303\177\144\157\017\341"
	"\325\206\161\204\204\361\150\021\367\121\354\160\316\310\364\010"
	"\014\140\137\176\021\271\361\251\124\375\166\173\043\126\110\001"
	"\271\133\024\060\232\010\030\333\131\067\145\166\145\365\051\313"
	"\126\164\002\016\062\260\122\264\361\306\324\021\162\327\025\203"
	"\346\151\136\307\131\074\172\010\347\050\010\215\176\261\317\172"
	"\076\111\156\274\004\230\276\342\237\264\221\054\303\221\116\210"
	"\047\341\151\177\060\055\002\261\340\012\116\242\255\022\120\024"
	"\314\365\171\171\344\031\021\343\146\326\321\140\277\112\147\051"
	"\070\145\036\307\345\220\017\275\344\020\266\340\116\212\360\104"
	"\350\172\121\327\253\125\206\102\345\172\000\170\233\217\002\173"
	"\121\311\106\137\255\217\263\175\335\373\303\134\372\207\074\157"
	"\321\221\150\333\354\172\023\377\032\326\126\247\160\370\317\171"
	"\064\132\250\044\202\033\371\365\372\261\057\160\123\342\343\147"
	"\265\272\023\104\373\343\033\301\243\027\315\121\123\161\135\136"
	"\064\157\131\270\235\212\220\230\100\227\307\261\146\217\350\022"
	"\174\237\352\272\125\172\204\102\310\304\041\156\164\224\354\012"
	"\236\324\156\351\012\131\333\362\025\342\105\005\036\065\263\024"
	"\106\152\177\001\231\154\044\350\137\356\331\167\236\213\142\370"
	"\163\041\152\174\033\313\262\124\075\222\245\122\367\272\117\341"
	"\025\307\006\133\150\377\126\270\271\035\011\141\337\306\257\262"
	"\146\301\277\273\245\166\120\243\246\110\020\074\112\030\223\312"
	"\000\153\304\274\102\037\317\100\263\050\310\377\034\370\356\145"
	"\046\147\155\305\330\361\306\344\244\101\235\036\070\073\222\055"
	"\151\123\045\272\146\253\015\310\201\304\137\330\006\170\177\360"
	"\134\326\323\025\061\227\336\375\336\213\122\164\235\270\332\142"
	"\216\132\171\107\260\232\363\036\307\031\223\353\134\341\337\241"
	"\037\110\264\312\232\034\330\356\161\126\056\256\133\034\023\343"
	"\172\105\172\176\305\137\167\317\123\250\350\222\034\173\172\042"
	"\253\026\243\034\112\171\013\010\171\206\373\344\143\136\327\047"
	"\342\376\014\136\017\013\366\214\365\014\035\107\272\266\126\113"
	"\345\200\152\372\313\366\271\070\164\101\205\260\045\165\052\341"
	"\267\050\335\147\356\151\167\222\250\173\164\176\001\221\372\140"
	"\200\153\345\316\324\356\104\315\127\166\071\324\016\117\333\044"
	"\013\072\265\057\040\351\361\072\266\034\342\300\202\351\034\276"
	"\226\052\300\141\173\321\127\250\266\274\223\272\231\271\014\144"
	"\255\311\162\363\171\350\257\263\377\023\105\342\114\275\110\155"
	"\125\333\304\345\053\225\205\210\123\056\056\354\143\011\256\275"
	"\270\166\315\264\261\175\161\234\111\260\112\223\146\166\172\267"
	"\021\137\036\004\360\332\171\140\317\123\346\244\241\076\322\100"
	"\146\356\310\206\037\161\161\227\142\144\136\032\336\305\110\365"
	"\177\052\255\211\355\361\120\200\342\237\063\121\263\332\031\057"
	"\053\040\123\174\215\065\127\251\366\347\026\223\162\137\007\355"
	"\212\371\357\107\033\332\272\233\207\236\157"
#define      inlo_z	3
#define      inlo	((&data[1681]))
	"\117\202\160"
#define      lsto_z	1
#define      lsto	((&data[1684]))
	"\344"
#define      chk1_z	22
#define      chk1	((&data[1687]))
	"\200\066\135\216\241\277\024\114\344\273\142\167\373\171\342\111"
	"\344\141\305\073\331\342\023\025\145\254"
#define      msg2_z	19
#define      msg2	((&data[1714]))
	"\242\263\007\171\275\232\270\161\120\010\042\251\323\313\342\230"
	"\363\105\363\065\375\333\076\355\236"
#define      pswd_z	256
#define      pswd	((&data[1753]))
	"\115\240\312\246\071\225\353\222\007\304\117\364\013\325\366\254"
	"\120\304\015\061\107\356\167\252\206\335\143\214\130\122\027\172"
	"\117\022\170\271\116\060\325\343\371\015\207\163\123\243\072\074"
	"\260\056\326\116\271\375\023\300\310\307\340\041\076\257\216\175"
	"\231\214\033\001\061\053\374\354\140\254\044\075\002\047\257\104"
	"\154\323\317\113\277\071\374\004\352\262\163\157\343\256\362\265"
	"\165\374\323\113\150\222\242\045\076\270\045\061\155\355\335\137"
	"\016\325\204\044\012\224\311\373\032\141\010\074\145\056\273\015"
	"\336\176\151\105\075\124\172\022\034\134\107\202\310\040\006\004"
	"\133\007\337\351\116\237\226\112\222\146\302\320\133\077\121\243"
	"\375\341\264\335\245\330\133\055\005\331\312\345\210\274\066\377"
	"\040\365\211\265\267\237\277\271\305\124\115\175\240\275\055\004"
	"\301\221\127\117\152\253\251\125\204\022\163\035\071\064\343\067"
	"\013\171\217\135\153\247\250\142\311\343\177\344\004\106\031\015"
	"\252\355\031\046\317\243\030\240\254\136\302\004\250\367\243\136"
	"\315\044\351\000\256\137\100\031\331\015\006\041\045\220\006\117"
	"\212\014\040\314\366\364\034\164\156\241\023\073\161\162\050\102"
	"\155\005\124\351\311\172\022\077\111\354\071\042\005"
#define      xecc_z	15
#define      xecc	((&data[2021]))
	"\256\324\253\161\064\252\263\112\222\014\160\146\052\343\124\357"
	"\141\223"
#define      rlax_z	1
#define      rlax	((&data[2039]))
	"\313"
#define      opts_z	1
#define      opts	((&data[2040]))
	"\152"
#define      chk2_z	19
#define      chk2	((&data[2043]))
	"\125\046\314\036\306\162\274\200\256\034\136\147\055\156\371\235"
	"\137\253\072\160\011"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */
#define BUSYBOXON	0	/* Define as 1 to enable work with busybox */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

void chkenv_end(void);

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask = (unsigned long)getpid();
	stte_0();
	 key(&chkenv, (void*)&chkenv_end - (void*)&chkenv);
	 key(&data, sizeof(data));
	 key(&mask, sizeof(mask));
	arc4(&mask, sizeof(mask));
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

void chkenv_end(void){}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];
	if (me == NULL) { me = getenv("_"); }
	if (me == 0) { fprintf(stderr, "E: neither argv[0] nor $_ works."); exit(1); }

	ret = chkenv(argc);
	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
#if BUSYBOXON
	varg[j++] = "busybox";
	varg[j++] = "sh";
#else
	varg[j++] = argv[0];		/* My own name at execution */
#endif
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
